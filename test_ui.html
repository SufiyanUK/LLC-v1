<!DOCTYPE html>
<html>
<head>
    <title>Employee Tracker - Test UI</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a202c;
            margin-bottom: 20px;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }
        .status {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            min-width: 150px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }
        .stat-label {
            font-size: 12px;
            color: #718096;
            text-transform: uppercase;
            margin-top: 5px;
        }
        .company-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        .company-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        .company-name {
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }
        .company-count {
            color: #4a5568;
            font-size: 14px;
        }
        button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #3182ce;
        }
        .error {
            color: #e53e3e;
            padding: 10px;
            background: #fff5f5;
            border: 1px solid #feb2b2;
            border-radius: 6px;
            margin: 10px 0;
        }
        .success {
            color: #38a169;
            padding: 10px;
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 6px;
            margin: 10px 0;
        }
        .log {
            background: #2d3748;
            color: #a0aec0;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 2px 0;
        }
        .highlight {
            color: #68d391;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Employee Tracker - Test UI</h1>

        <div class="section">
            <h2>Connection Test</h2>
            <button onclick="testConnection()">Test API Connection</button>
            <button onclick="loadAllData()">Load All Data</button>
            <button onclick="clearLog()">Clear Log</button>
            <div id="connectionStatus"></div>
        </div>

        <div class="section">
            <h2>Tracking Statistics</h2>
            <div id="statusStats" class="status"></div>
        </div>

        <div class="section">
            <h2>Companies (with employee counts)</h2>
            <div id="companyGrid" class="company-grid"></div>
        </div>

        <div class="section">
            <h2>Debug Log</h2>
            <div id="debugLog" class="log"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8001';

        function log(message, type = 'info') {
            const logDiv = document.getElementById('debugLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';

            const timestamp = new Date().toLocaleTimeString();
            let prefix = '';
            let style = '';

            switch(type) {
                case 'success':
                    prefix = '‚úÖ';
                    style = 'color: #68d391;';
                    break;
                case 'error':
                    prefix = '‚ùå';
                    style = 'color: #fc8181;';
                    break;
                case 'data':
                    prefix = 'üìä';
                    style = 'color: #63b3ed;';
                    break;
                default:
                    prefix = '‚ÑπÔ∏è';
            }

            entry.innerHTML = `<span style="${style}">[${timestamp}] ${prefix} ${message}</span>`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
            log('Log cleared', 'info');
        }

        async function testConnection() {
            log('Testing API connection...', 'info');
            const statusDiv = document.getElementById('connectionStatus');

            try {
                const response = await fetch(`${API_BASE}/health`);
                const data = await response.json();

                if (response.ok) {
                    statusDiv.innerHTML = '<div class="success">‚úÖ API is connected and running!</div>';
                    log(`API Health: ${JSON.stringify(data)}`, 'success');
                } else {
                    statusDiv.innerHTML = '<div class="error">‚ùå API returned error</div>';
                    log(`API Error: ${response.status}`, 'error');
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="error">‚ùå Cannot connect to API: ${error.message}</div>`;
                log(`Connection failed: ${error.message}`, 'error');
                log('Make sure the server is running: python api_v2.py', 'error');
            }
        }

        async function loadStatus() {
            log('Loading tracking status...', 'info');

            try {
                const response = await fetch(`${API_BASE}/track/status`);
                const data = await response.json();

                log(`Status loaded: ${data.total_tracked} total, ${data.active} active`, 'data');

                const statsDiv = document.getElementById('statusStats');
                statsDiv.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${data.total_tracked || 0}</div>
                        <div class="stat-label">Total Tracked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.active || 0}</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${data.departed || 0}</div>
                        <div class="stat-label">Departed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${Object.keys(data.companies || {}).length}</div>
                        <div class="stat-label">Companies</div>
                    </div>
                `;

                log('Status display updated', 'success');
            } catch (error) {
                log(`Failed to load status: ${error.message}`, 'error');
            }
        }

        async function loadCompanies() {
            log('Loading companies...', 'info');

            try {
                const response = await fetch(`${API_BASE}/companies`);
                const data = await response.json();

                log(`Loaded ${data.companies.length} companies`, 'data');

                const gridDiv = document.getElementById('companyGrid');
                gridDiv.innerHTML = '';

                data.companies.forEach(company => {
                    const count = data.employee_counts ? (data.employee_counts[company] || 0) : 0;
                    const isCustom = data.custom && data.custom.includes(company);

                    const box = document.createElement('div');
                    box.className = 'company-box';
                    box.innerHTML = `
                        <div class="company-name">${company} ${isCustom ? 'üÜï' : ''}</div>
                        <div class="company-count">üë• ${count} employee${count !== 1 ? 's' : ''}</div>
                    `;
                    gridDiv.appendChild(box);
                });

                // Log company details
                if (data.employee_counts) {
                    const companiesWithEmployees = Object.entries(data.employee_counts)
                        .filter(([_, count]) => count > 0);
                    log(`Companies with employees: ${companiesWithEmployees.length}`, 'data');
                    companiesWithEmployees.forEach(([company, count]) => {
                        log(`  ${company}: ${count} employees`, 'data');
                    });
                }

                log('Companies display updated', 'success');
            } catch (error) {
                log(`Failed to load companies: ${error.message}`, 'error');
            }
        }

        async function loadAllData() {
            log('Loading all data...', 'info');
            await testConnection();
            await loadStatus();
            await loadCompanies();
            log('All data loaded!', 'success');
        }

        // Load data on page load
        window.onload = function() {
            log('Page loaded - Employee Tracker Test UI', 'info');
            log(`API Base: ${API_BASE}`, 'info');
            loadAllData();
        };
    </script>
</body>
</html>